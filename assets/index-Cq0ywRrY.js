(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const L=new Map;function D(e){const t=L.get(e);return t?Promise.resolve(t):new Promise((a,r)=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{const o={img:n,width:n.width,height:n.height};L.set(e,o),a(o)},n.onerror=r,n.src=e})}function G(e){return L.get(e)||null}function U(e){return Promise.all(e.map(t=>D(t)))}const F={Arabic:"sa",Chinese:"cn",Danish:"dk",English:"gb",Finnish:"fi",French:"fr",German:"de",Guarani:"py",Hebrew:"il",Hindi:"in",Irish:"ie",Italian:"it",Japanese:"jp",Korean:"kr",Norwegian:"no",Portuguese:"pt",Russian:"ru",Spanish:"es",Swahili:"ke",Swedish:"se",Turkish:"tr"};function $(e){const t=F[e];return t?`./flags/${t}.png`:(console.warn(`No flag mapping for language: ${e}`),null)}const z={"United States of America":"USA","United Kingdom":"Great-Britain","Czech Republic":"Czechia","Republic of Congo":"Congo","Democratic Republic of the Congo":"Democratic-Rep-Congo","Dominican Republic":"Dominican-Rep","Bosnia and Herzegovina":"Bosnia-Herzegovina","Ivory Coast":"Cote-dIvoire","The Bahamas":"Bahamas","United Republic of Tanzania":"Tanzania","Republic of Serbia":"Serbia",Turkey:"TÃ¼rkiye",Laos:"Lao",Swaziland:"eSwatini","Burkina Faso":"Burkina-Faso","Guinea Bissau":"Guinea Bissau","Saudi Arabia":"Saudi-Arabia","Costa Rica":"Costa-Rica","El Salvador":"El-Salvador","South Korea":"South Korea","North Korea":"North Korea","South Sudan":"South Sudan","Sri Lanka":"Sri Lanka","East Timor":"East Timor","Papua New Guinea":"Papua New Guinea","New Zealand":"New Zealand","Solomon Islands":"Solomon Islands","Marshall Islands":"Marshall Islands","Trinidad and Tobago":"Trinidad and Tobago","Equatorial Guinea":"Equatorial Guinea","Central African Republic":"Central African Republic","United Arab Emirates":"United Arab Emirates","Sierra Leone":"Sierra Leone","Cabo Verde":"Cabo-Verde",Greenland:"Denmark"};let w=new Map,A=new Map,I=null,g=K(),h=O(),N=0;function K(){const e=new URLSearchParams(window.location.search),t=parseInt(e.get("year"));return t>=2020&&t<=2025?t:2025}function O(){const e=new URLSearchParams(window.location.search),t=parseInt(e.get("rank"));return t===1||t===2?t:1}function k(){const e=new URLSearchParams;g!==2025&&e.set("year",g),h!==1&&e.set("rank",h);const t=e.toString(),a=t?`${window.location.pathname}?${t}`:window.location.pathname;window.history.replaceState(null,"",a)}const l=new maplibregl.Map({container:"map",zoom:1.5,center:[0,20],minZoom:1,maxZoom:8,pitchWithRotate:!1});l.dragRotate.disable();l.touchZoomRotate.disableRotation();Promise.all([j(),H()]).then(([e,t])=>{w=e,I=t,_(t),V()});function j(){return fetch("./duo-data.csv").then(e=>e.text()).then(q)}function q(e){const t=e.trim().split(`
`),a=t[0].split(","),r=new Map;for(let n=1;n<t.length;n++){const o=t[n].split(","),i=o[0],s={};for(let c=1;c<a.length;c++){const u=a[c].match(/pop(\d)_(\d{4})/);if(u){const y=parseInt(u[1]),d=parseInt(u[2]);s[d]||(s[d]={}),s[d][y]=o[c]}}r.set(i,s)}return r}function H(){return fetch("./ne_110m_admin_0_countries.geojson").then(e=>e.json())}function _(e){l.addSource("borders",{type:"geojson",data:e}),l.addLayer({id:"country-fills",type:"fill",source:"borders",paint:{"fill-opacity":0}}),l.addLayer({id:"country-borders",type:"line",source:"borders",paint:{"line-color":"#ffffff","line-width":1}}),B(e);const t=document.getElementById("tooltip");l.on("mousemove","country-fills",a=>{if(a.features.length){const r=b(a.features[0]),n=C(r);t.innerHTML=`<strong>${r}</strong><br>#${h}: ${n||"N/A"}`,t.style.left=a.point.x+10+"px",t.style.top=a.point.y+10+"px",t.style.display="block"}}),l.on("mouseleave","country-fills",()=>{t.style.display="none"})}function b(e){return e.properties.ADMIN||e.properties.admin||e.properties.NAME}function C(e){const t=z[e]||e,a=w.get(t)||w.get(t.replace(/ /g,"-"))||w.get(t.replace(/-/g," "));return!a||!a[g]?null:a[g][h]}async function B(e){const t=++N,a=new Map(A),r=new Map,n=new Set;for(const o of e.features){const i=b(o),s=C(i);if(s){const c=$(s);c&&n.add(c)}}if(await U([...n]),t===N){for(const o of e.features)Z(o,t,r);for(const[o,i]of a)l.getLayer(o)&&l.removeLayer(o),l.getSource(o)&&l.removeSource(o),i instanceof HTMLCanvasElement&&i.remove();A=r}}function Z(e,t,a){const r=b(e),n=C(r);if(!n)return;const o=$(n);if(o)try{e.geometry.type==="MultiPolygon"?e.geometry.coordinates.forEach((i,s)=>{x(o,i,r,s,t,a)}):e.geometry.type==="Polygon"&&x(o,e.geometry.coordinates,r,0,t,a)}catch(i){console.warn(`Failed to render ${r}:`,i)}}function x(e,t,a,r,n,o){const i=t[0],s=J(e,i),c=`flag-${n}-${a}-${r}`;s.canvas.id=`canvas-${c}`,s.canvas.style.display="none",document.body.appendChild(s.canvas),l.addSource(c,{type:"canvas",canvas:s.canvas.id,coordinates:s.coordinates,animate:!1}),l.addLayer({id:c,type:"raster",source:c,paint:{"raster-opacity":.85}},"country-borders"),o.set(c,s.canvas)}function J(e,t){const a=G(e);if(!a)throw new Error(`Image not preloaded: ${e}`);let r=1/0,n=1/0,o=-1/0,i=-1/0;for(const[p,m]of t)p<r&&(r=p),m<n&&(n=m),p>o&&(o=p),m>i&&(i=m);const s=85.0511;n=Math.max(n,-s),i=Math.min(i,s);const c=S(r,i),v=S(o,n),u=document.createElement("canvas"),y=u.width=a.width,d=u.height=a.height,f=u.getContext("2d");f.beginPath();let R=!0;for(const[p,m]of t){const E=S(p,Math.max(-s,Math.min(s,m))),M=(E.x-c.x)/(v.x-c.x)*y,T=(E.y-c.y)/(v.y-c.y)*d;R?(f.moveTo(M,T),R=!1):f.lineTo(M,T)}return f.closePath(),f.clip(),f.drawImage(a.img,0,0,y,d),{canvas:u,coordinates:[[r,i],[o,i],[o,n],[r,n]]}}function S(e,t){const r=Math.PI/180,n=Math.sin(t*r);return{x:6378137*e*r,y:6378137*Math.log((1+n)/(1-n))/2}}function V(){const e=document.querySelectorAll(".year-btn"),t=document.querySelectorAll('input[name="rank"]');e.forEach(a=>{parseInt(a.dataset.year)===g?a.classList.add("active"):a.classList.remove("active")}),t.forEach(a=>{a.checked=parseInt(a.value)===h}),e.forEach(a=>{a.addEventListener("click",()=>{g=parseInt(a.dataset.year),e.forEach(r=>r.classList.remove("active")),a.classList.add("active"),k(),P()})}),t.forEach(a=>{a.addEventListener("change",r=>{h=parseInt(r.target.value),k(),P()})})}function P(){I&&B(I)}
